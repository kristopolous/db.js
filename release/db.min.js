var module=module||{},DB=module.exports=function(){"use strict";var _u,slice=Array.prototype.slice,toString=Object.prototype.toString,_orderCache={},_compProto={},_stainID=0,_stainKey="_4ab92bf03191c585f182",_={isFun:function(r){return!!(r&&r.constructor&&r.call&&r.apply)},isStr:function(r){return!!(""===r||r&&r.charCodeAt&&r.substr)},isNum:function(r){return"[object Number]"===toString.call(r)},isUndef:function(r){return isNaN(r)||null===r||r===_u},isScalar:function(r){return _.isStr(r)||_.isNum(r)||_.isBool(r)},isArr:[].isArray||function(r){return"[object Array]"===toString.call(r)},isBool:function(r){return!0===r||!1===r||"[object Boolean]"===toString.call(r)},isObj:function(r){return!(_.isFun(r)||_.isStr(r)||_.isNum(r)||_.isArr(r))&&(null==r?"object"===String(r):"[object Object]"===toString.call(r)||!0)}},proxy=function(r,n){return function(){n.apply(r,slice.call(arguments))}},indexOf=[].indexOf?function(r,n){return r.indexOf(n)}:function(r,n){for(var e=r.length-1;-1!==e&&n!==r[e];e--);return e},keys=Object.keys||function(r){var n,e=[];for(n in r)e.push(n);return e},values=function(r){var n,e=[];for(n in r)e.push(r[n]);return e},obj=function(r,n){var e={};return e[r]=n,e},mapArity=function(r,n){for(var e=[],t=0,i=r.length;t<i;t++)e.push(n.call(0,r[t]));return e},mapSoft=function(r,n,e){for(var t=[],i=0,a=r.length;i<a;i++)t.push(e?n(r[i]):n(r[i],i));return t},map=[].map?function(r,n){return r.map(n)}:mapSoft,_filterThrow=function(r){for(var n=this.length,e=0;e<n;e++)if(r(this[e]))throw this[e];return[]},_filter=function(r){for(var n=this.length,e=0,t=[],i=0;i<n;i++)r(this[i])||(e!==i&&t.splice.apply(t,[i,i].concat(this.slice(e,i))),e=i+1);return e!==i&&t.splice.apply(t,[i,i].concat(this.slice(e,i))),t},each=[].forEach?function(r,n){if(_.isArr(r))0!==r.length&&r.forEach(n);else if(_.isStr(r)||_.isNum(r)||_.isBool(r))n(r);else for(var e in r)n(e,r[e])}:function(r,n){if(0!==r.length)if(_.isArr(r))for(var e=0,t=r.length;e<t;e++)n(r[e],e);else for(var i in r)n(i,r[i])};function escapeRegExp(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function extend(e){return each(slice.call(arguments,1),function(r){if(r)for(var n in r)e[n]=r[n]}),e}function kvarg(r){var n={};return 2===r.length?(n[r[0]]=r[1],n):1===r.length?r[0]:void 0}function hash(r){var n={};return each(r,function(r){n[r]=!0}),n}function trace(t,i){if(!t||_.isBool(t))return trace.active=0===arguments.length?!trace.active:t,i&&(trace.cb=i),trace.active;var a;t.__trace__||(t.__trace__={},a=0,each(t,function(e,r){_.isFun(r)&&(t.__trace__[e]=r,t[e]=function(){a++;var r=slice.call(arguments),n=[e].concat(r);i?i({this:this,args:r,func:e,level:a}):(trace.l%=500,console.log(trace.l,n),trace[trace.l++]=n);r=t.__trace__[e].apply(this,r);return a--,r})}))}function copy(r){return"length"in r?slice.call(r):values(r)}function setdiff(r,n){var e=[];stain(n);for(var t=0,i=r.length;t<i;t++)isStained(r[t])?unstain(r[t]):e.push(r[t]);return e}function stain(r){_stainID++,each(r,function(r){r[_stainKey]=_stainID})}function unstain(r){delete r[_stainKey]}function isStained(r){return r[_stainKey]===_stainID}function has(r,n){var e=arguments.length,t=1===e?r:n,i={};return n=_.isArr(t)?(e=t.length,function(r){for(var n=0;n<e;n++)if(-1<indexOf(r,t[n]))return!0;return!1}):function(r){return-1<indexOf(r,t)},2===e?((i={})[r]=n,i):n}function val_comprehension(r){if(_.isObj(r)){var n=keys(r)[0],e=n.slice(1);try{r=DB[e](r[n])}catch(r){throw new Error(e+" is an unknown function")}}else _.isArr(r)&&(r=isin(r));return r}function find(){var t,r,n,i,e=slice.call(arguments),a=_.isArr(this)?this:e.shift();for(2===e.length&&_.isStr(e[0])&&((n={})[e[0]]=e[1],e=[n]),r=0;r<e.length;r++){var s,c,u=e[r];_.isArr(u)?(c=_.isScalar(u[0])&&2===e.length?(s=val_comprehension(e.pop()),[function(r){for(var n=0;n<u.length;n++)if(equal(r[u[n]],s))return!0}]):map(u,expression()),t=c.length,a=_filter.call(a,function(r){for(var n=!0,e=0;e<t;e++){if(c[e](r))return!0;n=!1}return n})):_.isFun(u)?a=_filter.call(a,u):each(u,function(n,e){e=val_comprehension(e),c=_.isFun(e)?function(r){if(n in r)return i=r[n],_.isFun(i)&&(i=i()),e(i,r)}:function(r){return i=r[n],_.isFun(i)&&(i=i()),n in r&&i===e},a=_filter.call(a,c)})}return a}function missing(r){var e=hash(r);return function(r){for(var n in e)if(n in r)return!1;return!0}}each("< <= > >= == === != !==".split(" "),function(r){_compProto[r]=Function("rhs","return function(x){return x"+r+"rhs}")}),trace.l=0,trace.active=!1;var isin=function(r,n){var e=arguments.length,t=1===e?r:n||[],i=[],a=[],s={};if(!_.isArr(t))throw new TypeError("isin's argument is wrong. ",t);return n=t.length?(each(t,function(r){(_.isFun(r)?i:a).push(r)}),function(r){for(var n=-1<indexOf(a,r),e=0;e<i.length&&!n;e++)n=i[e](r);return n}):_.isFun(t)?function(r){return-1<indexOf(t(),r)}:t,2===e?((s={})[r]=n,s):n};function equal(r,n){return r===n||_.isFun(n)&&n(r)||!_.isUndef(r)&&r.join&&n.join&&r.sort().toString()===n.sort().toString()||JSON.stringify(r)===JSON.stringify(n)}function isArray(r){var n=r.sort().join("");return function(r){return r.sort().join("")===n}}function like(r,n){var e,t,i=arguments.length,a={};if(1===i?e=r:2===i&&(e=n),_.isArr(e)){for(var s=0;s<e.length;s++)if(console.log(r,e[s]),like(r,e[s]))return!0;return!1}return e=e.toString(),n=function(r){if(null===r)return!1;try{t=new RegExp(e,"img")}catch(r){t=new RegExp(escapeRegExp(e),"img")}return-1<r.toString().search(t)},2===i?((a={})[r]=n,a):n}function update(r,n){var e,t=this;return n!==_u&&(e=r,(r={})[e]=n),_.isFun(r)?each(t,r):each(r,function(n,e){_.isFun(e)?each(t,function(r){_.isFun(r[n])?r[n](e(r)):r[n]=e(r)}):each(t,function(r){_.isFun(r[n])?r[n](e):r[n]=e})}),this}function not(r){return function(){return!r.apply(this,arguments)}}var _fCache={},_eCache={};function ewrap(arg,str){var key=str+":"+arg;if(!(key in _eCache))try{_eCache[key]=eval("(function("+arg+"){"+str+"})")}catch(ex){_eCache[key]=!1}return _eCache[key]}function fwrap(r,n){var e=n+":"+r;if(!(e in _fCache))try{_fCache[e]=new Function(r,"try{return "+n+"}catch(e){}")}catch(r){_fCache[e]=!1}return _fCache[e]}var expression=function(){return function(r,n){var e,t;if(_.isStr(r))return t=r,2===arguments.length&&_.isStr(n)?(e=fwrap("x,rec","x."+r+(t=n)))[r]=fwrap("x,rec","x "+t):e=(e=fwrap("x,rec","x "+t))||fwrap("rec",r),e;if(_.isObj(r)){var i,a,s=[],c=[];for(a in r)i=r[a],_.isScalar(i)?(_.isStr(i)&&(i='"'+i+'"'),s.push("rec['"+a+"']==="+i)):_.isArr(i)?c.push(isin(a,i)):s.push("equal(rec['"+a+"'],arg0['"+a+"'])");return s.length&&c.push(ewrap("rec,arg0","return "+s.join("&&"))),function(r,n){for(var e,t,i,a=0;a<c.length;a++)if(e=c[a],_.isObj(e)){if(i=e[t=keys(e)[0]],_.isArr(i)){if(-1===indexOf(i,r[t]))return!1}else if(!i(r[t]))return!1}else if(!e(r,n))return!1;return!0}}}};function eachRun(r,n){var e,t=0,i=[];if(2===arguments.length?(e=r,r=n):e=_.isArr(this)?this:this.find(),_.isArr(r)&&2===r.length&&(t=r[0],r=r[1]),_.isArr(e))i=mapSoft(e,r);else for(var a in i={},e)_.isFun(e[a])||(i[a]=r.call(t,e[a]));return i}var chainList=hash(["distinct","each","find","findFirst","first","group","groupBy","has","hasKey","indexBy","insert","invert","isin","keyBy","lazyView","like","missing","order","orderBy","remove","schema","select","slice","sort","unset","update","view","where"]);function DB(arg0,arg1){var constraints={addIf:[]},constrainCache={},syncList=[],syncLock=!1,_ix={ins:0,del:0},_template=!1,ret=expression(),_g={},raw=[],fails;function sync(){syncLock||(syncLock=!0,each(syncList,function(r){r.call(ret,raw)}),syncLock=!1)}function chain(r){for(var n in chainList)r[n]=ret[n];return r.last=r[r.length-1],r}function list2data(r){for(var n=[],e=0,t=r.length;e<t;e++)n[e]=raw[r[e]];return n}if(extend(ret,{slice:function(){var r=_.isArr(this)?this:ret.find();return chain(slice.apply(r,arguments))},transaction:{start:function(){syncLock=!0},end:function(){syncLock=!1,sync()}},schema:function(){for(var r={},n=_.isArr(this)?this:ret.find(),e=n.length,t=Math.ceil(Math.min(10,e/3)),i=0;i<e;i+=t)for(var a in n[i])r[a]=_u;return keys(r)},constrain:function(){extend(constraints,kvarg(arguments))},addIf:function(r){return r&&constraints.addIf.push(r),constraints.addIf},beforeAdd:function(r){return ret.addIf(!!r&&function(){return r.apply(0,arguments),!0})},unset:function r(n){if(_.isArr(n))return each(n,r);var e=_.isArr(this)?this:ret.find();return each(e,function(r){n in r&&delete r[n]}),sync(),chain(e)},each:eachRun,isFunction:_.isFun,isString:_.isStr,map:eachRun,not:not,findFirst:function(){var n,r=_filter,e=!1;_filter=_filterThrow;try{n=ret.find.apply(this,arguments)}catch(r){n=r,e=!0}return _filter=r,e?n:!!n.length&&n[0]},has:has,hasKey:function(){var r=_.isArr(this)?this:this.find(),n=r.find(missing(slice.call(arguments)));return this.invert(n,r)},isin:isin,like:like,invert:function(r,n){return chain(setdiff(n||raw,r||this))},missing:function(){var r=missing(slice.call(arguments));return _.isArr(this)?this.find(r):r},sync:function(r){return r?syncList.push(r):sync(),ret},template:function(r){return _template=r,ret},update:function(){var r=update.apply(_.isArr(this)?this:ret.find(),arguments);return sync(),chain(r)}}),extend(ret.template,{create:ret.template,update:function(r){return extend(_template||{},r),ret},get:function(){return _template},destroy:function(){return _template=!1,ret}}),ret.first=ret.findFirst,ret.groupBy=ret.group=function(){var e=slice.call(arguments||[]),t=e.shift(),i={},r=_.isArr(this)?this:ret.find();return each(r,function(n){var r=t in n?n[t]:[_u];each(r,function(r){r in i||(i[r]=chain([])),i[r].push(n)})}),e.length&&each(i,function(r,n){i[r]=ret.group.apply(n,e)}),i},ret.keyBy=function(){var e=ret.group.apply(this,arguments);return each(e,function(r,n){e[r]=n[0]}),e},ret.distinct=function(r){return keys(ret.keyBy(r))},ret.indexBy=function(){var r=chain;chain=function(r){return r},ret.__raw__=raw=ret.order.apply(this,arguments),chain=r},ret.order=ret.sort=ret.orderBy=function(arg0,arg1){var key,fnSort,len=arguments.length,order,filter=_.isArr(this)?this:ret.find(),list=slice.call(filter);if(_.isFun(arg0))fnSort=arg0;else if(_.isStr(arg0)){if(key=arg0,1===len?order="x-y":2===len&&(order=_.isStr(arg1)?{asc:"x-y",desc:"y-x"}[arg1.toLowerCase()]:arg1),_.isStr(list[0][key])){var _group=ret.group.call(list,key),_sorted=keys(_group).sort(),_args=map(_sorted,function(r){return _group[r]}),_res=Array.prototype.concat.apply([],_args);return"y-x"===order&&(_res=_res.reverse()),_res}_.isStr(order)&&(order=_orderCache[order]||(_orderCache[order]=new Function("x,y","return "+order))),eval("fnSort=function(a,b){return order(a."+key+", b."+key+")}")}return chain(list.sort(fnSort))},ret.where=ret.find=function(){var r=slice.call(arguments||[]);return _.isArr(this)||(r=[raw].concat(r)),chain(find.apply(this,r))},ret.lazyView=function(field,type){var myix={del:_ix.del,ins:_ix.ins},res={},keyer;return-1===field.search(/[()]/)?("["===field.charAt(0)&&"."===field.charAt(0)||(field="."+field),eval("keyer=function(r,ref){try{ref[rX]=res[rX]=r;}catch(x){}}".replace(/X/g,field))):eval("keyer=function(r,ref){var val=r.X;try{ref[val]=res[val]=r;}catch(x){}}".replace(/X/g,field)),Object.defineProperty(res,"update",{enumerable:!1,configurable:!1,writable:!1,value:function(r){if(r){if("del"===r&&myix.del===_ix.del)return;if("ins"===r&&myix.ins===_ix.ins)return}myix={del:_ix.del,ins:_ix.ins};var n,e={};for(n in each(raw,function(r){keyer(r,e)}),res)n in e||"update"==n||delete res[n];Object.defineProperty(res,"length",{enumerable:!1,configurable:!1,writable:!0,value:Object.keys(res).length})}}),res.update(),res},ret.view=function(r,n){n=ret.lazyView(r,n);return ret.sync(n.update),n},ret.select=function(r){var a,s=_.isArr(this)?this:ret.find(),c={};return 1<arguments.length?r=slice.call(arguments):_.isStr(r)&&(r=[r]),a=r.length,each(r,function(r,n){if("*"===r)c=map(s,values);else for(var e=0,t=s.length;e<t;e++){var i=s[e];r in i&&(1<a?(c[e]||(c[e]=[]),c[e][n]=i[r]):c[e]=i[r])}}),chain(values(c))},ret.insert=function(r){var i,a=constraints.unique,s=[],n=[],c=[],n=1<arguments.length?slice.call(arguments):_.isArr(r)?r:[r];return each(n,function(n){var r,e,t=!0;a&&a in n&&(_g[r="c-"+a]?_g[r].update("del"):_g[r]=ret.lazyView(a),r=_g[r],n[a]in r?(s.push(r[n[a]]),c.push(r[n[a]]),t=!1):r[n[a]]=n),each(constraints.addIf,function(r){t&=r(n)}),t&&(_ix.ins++,i=raw.length,_template&&(e={},each(_template,function(r,n){_.isFun(n)?e[r]=n():e[r]=n}),n=extend(e,n)),raw.push(n),c.push(i))}),sync(),extend(chain(list2data(c)),{existing:s})},ret.flash=function(r){ret.__raw__=raw=raw.concat(r)},ret.trace=function(r){DB.trace(ret,r)},ret.remove=function(r){var n,e,t=!1,i=[];if(_.isArr(this))e=this;else if(_.isArr(r))e=r;else{if(0<arguments.length)return(i=ret.find.apply(this,arguments)).length&&(ret.__raw__=raw=ret.invert(i),_ix.del++,sync()),chain(i.reverse());e=ret.find()}stain(e);for(var a=raw.length-1,s=raw.length;0<=a;a--)isStained(raw[a])?(unstain(raw[a]),i.push(raw[a])):(s-(a+1)&&(n=a+1,raw.splice(n,s-n),t=!0),s=a);return s-(n=a+1)&&(raw.splice(n,s-n),t=!0),t&&(_ix.del++,sync()),chain(i.reverse())},1===arguments.length)if(_.isArr(arg0))ret.insert(arg0);else if(_.isFun(arg0))ret.insert(arg0());else{if(_.isStr(arg0))return ret.apply(this,arguments);_.isObj(arg0)&&(fails=!1,each(arg0,function(r,n){(fails=!ret[r]?!0:fails)||ret[r](n)}),fails&&ret.insert(arg0))}else 1<arguments.length&&ret.insert(slice.call(arguments));return ret.__raw__=raw,trace.active&&ret.trace(trace.cb),ret}extend(DB,{find:find,expr:expression(),diff:setdiff,each:eachRun,map:map,not:not,like:like,trace:trace,values:values,isin:isin,isArray:isArray,isString:_.isStr,isFunction:_.isFun,sort:function(){return DB(arguments[0]).sort.apply(0,slice.call(arguments,1))},local:function(){return"(function(){ return "+DB.apply(this,arguments).toString()+";})()"},copy:function(r){return map(r,function(r){return extend({},r)})},objectify:function(r,n){var i=[];return each(n,function(e){var t={};each(r,function(r,n){t[r]=e[n]}),i.push(t)}),i},reduceLeft:function(a,r){1===arguments.length&&(r=a,a=0);var s=_.isStr(r)?new Function("y,x","return y "+r):r;return function(r,n){for(var e=a,t=0,i=r.length;t<i;t++)r[t]&&(e=s(e,r[t],n));return e}},reduceRight:function(r,n){return 1===arguments.length&&(n=r,r=0),n=DB.reduceLeft(r,n),function(r){return n(r.reverse())}}});var any=DB.reduceLeft(0,function(r,n){return r||n});return DB}();DB.version="0.0.1.403-20210924";